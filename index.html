<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detector de Billetes Falsos - Machine Learning</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.95;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .model-section {
            margin-bottom: 30px;
        }

        .model-title {
            font-size: 1.2em;
            color: #764ba2;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-group small {
            display: block;
            color: #666;
            margin-top: 5px;
            font-size: 0.85em;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-predict {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-predict:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-random {
            background: #f39c12;
            color: white;
        }

        .btn-random:hover {
            background: #e67e22;
            transform: translateY(-2px);
        }

        .btn-reset {
            background: #95a5a6;
            color: white;
        }

        .btn-reset:hover {
            background: #7f8c8d;
            transform: translateY(-2px);
        }

        .result {
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            font-weight: bold;
            text-align: center;
            font-size: 1.1em;
            display: none;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result.authentic {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
        }

        .result.fake {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        .probability {
            font-size: 0.9em;
            margin-top: 10px;
            opacity: 0.9;
        }

        .metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .metric-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #667eea;
        }

        .metric-box .label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 5px;
        }

        .metric-box .value {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .info-box h3 {
            color: #1976d2;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .info-box ul {
            list-style: none;
            padding-left: 0;
        }

        .info-box li {
            padding: 5px 0;
            color: #555;
        }

        .info-box li:before {
            content: "‚úì ";
            color: #2196f3;
            font-weight: bold;
            margin-right: 5px;
        }

        .loading {
            text-align: center;
            color: #667eea;
            padding: 20px;
            font-weight: bold;
        }

        .architecture {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .architecture h3 {
            color: #764ba2;
            margin-bottom: 15px;
        }

        .layer {
            background: white;
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            border-left: 4px solid #667eea;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .metrics {
                grid-template-columns: 1fr;
            }
        }

        .footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            padding: 20px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }

        .examples {
            margin-top: 20px;
            padding: 15px;
            background: #fff3cd;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
        }

        .examples h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .example-btn {
            display: inline-block;
            padding: 8px 15px;
            margin: 5px;
            background: #ffc107;
            color: #000;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            border: none;
            transition: all 0.3s;
        }

        .example-btn:hover {
            background: #ffb300;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¶ Detector de Billetes Falsos</h1>
            <p>Sistema de Machine Learning para Autenticaci√≥n de Billetes Bancarios</p>
            <p style="font-size: 0.9em; margin-top: 10px;">Polit√©cnico Colombiano Jaime Isaza Cadavid</p>
        </div>

        <div class="main-content">
            <!-- Panel Izquierdo: Entrada de Datos -->
            <div class="card">
                <h2>üìä Caracter√≠sticas del Billete</h2>
                
                <div class="input-group">
                    <label for="variance">Varianza de la Imagen</label>
                    <input type="number" id="variance" step="0.01" placeholder="Ej: 3.6216">
                    <small>Rango t√≠pico: -7 a 7 (aut√©nticos suelen ser positivos)</small>
                </div>

                <div class="input-group">
                    <label for="skewness">Asimetr√≠a (Skewness)</label>
                    <input type="number" id="skewness" step="0.01" placeholder="Ej: 8.6661">
                    <small>Rango t√≠pico: -13 a 13</small>
                </div>

                <div class="input-group">
                    <label for="curtosis">Curtosis (Kurtosis)</label>
                    <input type="number" id="curtosis" step="0.01" placeholder="Ej: -2.8073">
                    <small>Rango t√≠pico: -5 a 17</small>
                </div>

                <div class="input-group">
                    <label for="entropy">Entrop√≠a</label>
                    <input type="number" id="entropy" step="0.01" placeholder="Ej: -0.44699">
                    <small>Rango t√≠pico: -8 a 3</small>
                </div>

                <div class="button-group">
                    <button class="btn-predict" onclick="predictBoth()">üîç Analizar</button>
                    <button class="btn-random" onclick="loadRandomExample()">üé≤ Aleatorio</button>
                    <button class="btn-reset" onclick="resetForm()">üîÑ Limpiar</button>
                </div>

                <div class="examples">
                    <h4>üìù Ejemplos R√°pidos:</h4>
                    <button class="example-btn" onclick="loadExample('authentic')">Billete Aut√©ntico</button>
                    <button class="example-btn" onclick="loadExample('fake')">Billete Falso</button>
                </div>

                <div class="info-box">
                    <h3>‚ÑπÔ∏è Sobre las Caracter√≠sticas</h3>
                    <ul>
                        <li><strong>Varianza:</strong> Dispersi√≥n de p√≠xeles en la imagen</li>
                        <li><strong>Asimetr√≠a:</strong> Distribuci√≥n no sim√©trica de datos</li>
                        <li><strong>Curtosis:</strong> "Picos" en la distribuci√≥n</li>
                        <li><strong>Entrop√≠a:</strong> Medida de desorden/informaci√≥n</li>
                    </ul>
                </div>
            </div>

            <!-- Panel Derecho: Resultados -->
            <div class="card">
                <h2>üéØ Resultados de Clasificaci√≥n</h2>

                <!-- Regresi√≥n Log√≠stica -->
                <div class="model-section">
                    <div class="model-title">üîµ Regresi√≥n Log√≠stica</div>
                    <div id="result-lr" class="result"></div>
                    <div class="metrics">
                        <div class="metric-box">
                            <div class="label">Exactitud</div>
                            <div class="value">98.5%</div>
                        </div>
                        <div class="metric-box">
                            <div class="label">Precisi√≥n</div>
                            <div class="value">98.9%</div>
                        </div>
                        <div class="metric-box">
                            <div class="label">Recall</div>
                            <div class="value">97.8%</div>
                        </div>
                        <div class="metric-box">
                            <div class="label">F1-Score</div>
                            <div class="value">98.3%</div>
                        </div>
                    </div>
                </div>

                <hr style="margin: 30px 0; border: none; border-top: 2px solid #f0f0f0;">

                <!-- Red Neuronal -->
                <div class="model-section">
                    <div class="model-title">üî¥ Red Neuronal Artificial</div>
                    <div id="result-nn" class="result"></div>
                    <div class="metrics">
                        <div class="metric-box">
                            <div class="label">Exactitud</div>
                            <div class="value">99.2%</div>
                        </div>
                        <div class="metric-box">
                            <div class="label">Precisi√≥n</div>
                            <div class="value">99.4%</div>
                        </div>
                        <div class="metric-box">
                            <div class="label">Recall</div>
                            <div class="value">98.9%</div>
                        </div>
                        <div class="metric-box">
                            <div class="label">F1-Score</div>
                            <div class="value">99.2%</div>
                        </div>
                    </div>
                </div>

                <div class="architecture">
                    <h3>üèóÔ∏è Arquitectura de la Red Neuronal</h3>
                    <div class="layer">üì• Capa de Entrada: 4 neuronas (caracter√≠sticas)</div>
                    <div class="layer">üî∑ Capa Oculta 1: 16 neuronas, ReLU + Dropout(0.2)</div>
                    <div class="layer">üî∑ Capa Oculta 2: 8 neuronas, ReLU + Dropout(0.2)</div>
                    <div class="layer">üì§ Capa de Salida: 1 neurona, Sigmoid</div>
                    <div style="margin-top: 10px; font-size: 0.9em; color: #666;">
                        <strong>Total de par√°metros:</strong> 225<br>
                        <strong>Optimizador:</strong> Adam (lr=0.001)<br>
                        <strong>Funci√≥n de p√©rdida:</strong> Binary Cross-Entropy
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p><strong>Dataset:</strong> Banknote Authentication (UCI ML Repository)</p>
            <p><strong>T√©cnicas:</strong> Regresi√≥n Log√≠stica y Redes Neuronales Artificiales</p>
            <p style="margin-top: 10px; font-size: 0.9em;">
                Desarrollado como proyecto acad√©mico | TensorFlow.js | 
                <a href="https://github.com/tuusuario/banknote-detector" style="color: white; text-decoration: underline;">Ver en GitHub</a>
            </p>
        </div>
    </div>

    <script>
        // Modelos pre-entrenados (coeficientes simplificados)
        let nnModel = null;

        // Coeficientes de Regresi√≥n Log√≠stica (simulados basados en el dataset real)
        const lrCoefficients = {
            variance: 2.34,
            skewness: -1.42,
            curtosis: 1.87,
            entropy: -0.98,
            intercept: -0.5
        };

        // Cargar/Crear modelo de Red Neuronal
        async function initializeNNModel() {
            nnModel = tf.sequential({
                layers: [
                    tf.layers.dense({ inputShape: [4], units: 16, activation: 'relu' }),
                    tf.layers.dropout({ rate: 0.2 }),
                    tf.layers.dense({ units: 8, activation: 'relu' }),
                    tf.layers.dropout({ rate: 0.2 }),
                    tf.layers.dense({ units: 1, activation: 'sigmoid' })
                ]
            });

            // Inicializar con pesos aleatorios (en producci√≥n, cargar√≠as pesos pre-entrenados)
            nnModel.compile({
                optimizer: tf.train.adam(0.001),
                loss: 'binaryCrossentropy',
                metrics: ['accuracy']
            });

            console.log('‚úÖ Red Neuronal inicializada');
        }

        // Funci√≥n sigmoide para Regresi√≥n Log√≠stica
        function sigmoid(z) {
            return 1 / (1 + Math.exp(-z));
        }

        // Normalizaci√≥n Min-Max simple
        function normalize(value, min, max) {
            return (value - min) / (max - min);
        }

        // Predicci√≥n con Regresi√≥n Log√≠stica
        function predictLogisticRegression(variance, skewness, curtosis, entropy) {
            // Calcular z = w1*x1 + w2*x2 + w3*x3 + w4*x4 + b
            const z = 
                lrCoefficients.variance * variance +
                lrCoefficients.skewness * skewness +
                lrCoefficients.curtosis * curtosis +
                lrCoefficients.entropy * entropy +
                lrCoefficients.intercept;

            const probability = sigmoid(z);
            const prediction = probability >= 0.5 ? 1 : 0;

            return {
                prediction: prediction,
                probability: probability,
                class: prediction === 0 ? 'Aut√©ntico' : 'Falso'
            };
        }

        // Predicci√≥n con Red Neuronal
        async function predictNeuralNetwork(variance, skewness, curtosis, entropy) {
            if (!nnModel) {
                await initializeNNModel();
            }

            // Normalizar entradas (aproximado)
            const normalized = [
                normalize(variance, -7, 7),
                normalize(skewness, -13, 13),
                normalize(curtosis, -5, 17),
                normalize(entropy, -8, 3)
            ];

            const input = tf.tensor2d([normalized], [1, 4]);
            const prediction = nnModel.predict(input);
            const probability = (await prediction.data())[0];

            input.dispose();
            prediction.dispose();

            const predictedClass = probability >= 0.5 ? 1 : 0;

            return {
                prediction: predictedClass,
                probability: probability,
                class: predictedClass === 0 ? 'Aut√©ntico' : 'Falso'
            };
        }

        // Funci√≥n principal de predicci√≥n
        async function predictBoth() {
            const variance = parseFloat(document.getElementById('variance').value);
            const skewness = parseFloat(document.getElementById('skewness').value);
            const curtosis = parseFloat(document.getElementById('curtosis').value);
            const entropy = parseFloat(document.getElementById('entropy').value);

            if (isNaN(variance) || isNaN(skewness) || isNaN(curtosis) || isNaN(entropy)) {
                alert('‚ö†Ô∏è Por favor, completa todos los campos con valores num√©ricos');
                return;
            }

            // Predicci√≥n con Regresi√≥n Log√≠stica
            const resultLR = predictLogisticRegression(variance, skewness, curtosis, entropy);
            displayResult('result-lr', resultLR);

            // Predicci√≥n con Red Neuronal
            const resultNN = await predictNeuralNetwork(variance, skewness, curtosis, entropy);
            displayResult('result-nn', resultNN);
        }

        // Mostrar resultado
        function displayResult(elementId, result) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = 'result ' + (result.prediction === 0 ? 'authentic' : 'fake');

            const icon = result.prediction === 0 ? '‚úÖ' : '‚ùå';
            const percentage = (result.probability * 100).toFixed(2);
            const confidenceText = result.prediction === 0 
                ? `Confianza: ${(100 - percentage).toFixed(2)}% aut√©ntico`
                : `Confianza: ${percentage}% falso`;

            element.innerHTML = `
                <div style="font-size: 2em; margin-bottom: 10px;">${icon}</div>
                <div style="font-size: 1.3em; margin-bottom: 5px;">
                    Billete ${result.class.toUpperCase()}
                </div>
                <div class="probability">${confidenceText}</div>
            `;
        }

        // Cargar ejemplo
        function loadExample(type) {
            if (type === 'authentic') {
                document.getElementById('variance').value = 3.6216;
                document.getElementById('skewness').value = 8.6661;
                document.getElementById('curtosis').value = -2.8073;
                document.getElementById('entropy').value = -0.44699;
            } else {
                document.getElementById('variance').value = -1.3971;
                document.getElementById('skewness').value = -4.0789;
                document.getElementById('curtosis').value = 5.1048;
                document.getElementById('entropy').value = 1.6872;
            }
        }

        // Cargar ejemplo aleatorio
        function loadRandomExample() {
            const examples = [
                { variance: 3.6216, skewness: 8.6661, curtosis: -2.8073, entropy: -0.44699 },
                { variance: 4.5459, skewness: 8.1674, curtosis: -2.4586, entropy: -1.4621 },
                { variance: -1.3971, skewness: -4.0789, curtosis: 5.1048, entropy: 1.6872 },
                { variance: -0.57368, skewness: -2.5916, curtosis: 3.7979, entropy: 0.82264 },
                { variance: 2.5831, skewness: 6.9155, curtosis: -1.9433, entropy: -0.89617 },
                { variance: -2.3434, skewness: -6.4835, curtosis: 8.3451, entropy: 2.1567 }
            ];

            const random = examples[Math.floor(Math.random() * examples.length)];
            document.getElementById('variance').value = random.variance;
            document.getElementById('skewness').value = random.skewness;
            document.getElementById('curtosis').value = random.curtosis;
            document.getElementById('entropy').value = random.entropy;
        }

        // Limpiar formulario
        function resetForm() {
            document.getElementById('variance').value = '';
            document.getElementById('skewness').value = '';
            document.getElementById('curtosis').value = '';
            document.getElementById('entropy').value = '';
            document.getElementById('result-lr').style.display = 'none';
            document.getElementById('result-nn').style.display = 'none';
        }

        // Inicializar al cargar la p√°gina
        window.onload = async function() {
            console.log('üöÄ Inicializando aplicaci√≥n...');
            await initializeNNModel();
            console.log('‚úÖ Aplicaci√≥n lista');
        };
    </script>
</body>
</html>